# RSA - Remote Shadow Administrator

Первостепенная цель программы, это подключение к текущим RDP-сессия по средствам Shadow-подключения. 100% кода на powershell и Windows Forms (без использования Visual Studio), можно использовать как альтернативное средство удаленного подключения (например, Radmin или VNC, которые требуют установки ПО по сети и имеют некоторые дыры в безопасности). Подобной реализации команды query и аудентификации в сети я не нашел.

При выборе сервера и нажатии на кнопку "Проверить" отображается список текущих пользователей в виде таблице, при выборе ID пользователя можно произвести действия подключения, отключения (выход из системы) и отправки сообщения с выбором всем пользователям на сервере или указанному. Создание таблицы происходит в 3 этапа, вначале проверяется доступность сервера, о чем сообщается в статус-баре и дополнительно проверяется uptime (если не доступен WinRM, программа об этом сообщит), если сервер не доступен, во избежании долгой задержки проверка пользователей не производится. На втором этапе парсится вывод команды query по средствам Regex, на последнем происходит создание Custom Object с выводом в GridView.

Подключение к серверу имеет ключ /admin, что позволяет подключаться к RDSH-серверу минуя Broker, для аутентификации используется cmdkey, распростроняется на все сервера в списке и действует до закрытия программы, что бы не хранить пароль администратора в коде а так же в хранилище ключей ОС. Список серверов хранится в файле RSA.conf.txt (%USERPROFILE%\Documents\), который можно вызвать из программы нажатием правой кнопки мыши в списке серверов или комбинацией клавиш Ctrl+S.

Программ имеет порядка 20 скриптов по удаленному взаимодействию и администрированию серверов и рабочих станция, а так же вывод всех команд в статус-бар снизу.

1. Типовые: shutdown с задержкий 30 секунд с возможность отмены (перезагрузка и выключение). Управление (Computer Management), gpupdate на удаленной машине, gpresult с выводом в XML-файл и указанием пользователя. Проверка служб с возможностью удобной фильтрации поиска и повторной проверкой статуса. Список всех процессов пользователей с возможностью их завершения. Список открытых SMB-сессий с их завершением для освобождения файла. Фильтрация логов. Просмотр всех сетевых ресурсов с возможностью открытия (в т.ч. c$).

2. Заимствованные: TCP Viewer (источник: winitpro.ru) - производит resolve FQDN для всех удаленных адресов и через Get-Process по ID определяет path исполняемого процесса. Подключение к Connection Broker (для подключения требуется модуль RemoteDesktop). Wake on Lan (источник: coolcode.ru) - формирование Magick Packet и отправкой broadcast (MAC-адрес берется из формы ввода сообщения). Просмотр свободного места на разделах дисков (источник: fixmypc.ru) и по аналогии ОЗУ.

3. Собственные идеи: 

3.1. Поиск MAC-адреса компьютера, которые уже не доступен по средствам просмотра ARP-таблиц на других сервера в кач-ве proxy, или подключение к серверу с ролью DHCP с помощью icm (установка модуля не требуется). 

3.2. WMI: 1). Просмотри списка обновлений с возможностью копирования номер в буфер обмена, в связи с тем, что более не поддерживается удаление обновлений через WUSA в тихом режиме, используется в связке с DISM online (специально оставил отдельной вкладкой, можно автоматизировать и/или отпарсить вывод dism). 2). Список установленных программ, используется два метода: get-packet и wmi с возможностью удаления. 3). Удаленная проверка и включение/отключение rdp и nla. 4). Инвентаризация оборудования - процессор, мат. плата, видеокарта, оперативная память, модели дисков, так же присутствует вывод всех сетевых адаптеро, очень часто в сканерах используется для инициализации хоста ВМ (раскомментировать строки 505-506) с ковертацией в HTML-файл.

3.3. Все срипты по синхронизации компьютерных часов - 1). отобращает текущее время на сервере и разница с сервером источником запроса. 2) Узнать источник времени и в силу сложности с парсингом в зависимости от языкового пакета - частоту и время последней синхронизации. 3) Проверка сервера как источника времени. 4) Незамедлительно синхронизировать время на удаленном сервере. 5) Изменить на удаленном сервере источник времени ближайший DC в подсети.

Моя база действий при анализе неработоспособности сервера: uptime, текущее время на сервере, последние установленные программы и обновления, анализ логов.
